import{r as e,h as t,H as s}from"./p-ee0b9025.js";import{c as r}from"./p-a3b5bd35.js";import{a as o,S as a}from"./p-c74b54ba.js";import{a as i}from"./p-4d2049bc.js";import"./p-4ebd2c24.js";import"./p-ca993e0f.js";import"./p-949334ec.js";import{a as n}from"./p-e1c2279c.js";import{W as l}from"./p-79414d9f.js";import{T as p}from"./p-64c0718a.js";import"./p-80de33dc.js";import"./p-3c89b68a.js";import"./p-d8454b73.js";import"./p-93cac3a6.js";import"./p-83f217d4.js";let c=class{constructor(t){e(this,t)}async getServerUrl(){return this.serverUrl}async workflowDefinitionIdChangedHandler(e){const t=e;let s={id:null,version:1,activities:[],connections:[],persistenceBehavior:o.WorkflowBurst,customAttributes:{data:{}},persistWorkflow:!1,isLatest:!1,isPublished:!1,loadWorkflowContext:!1,isSingleton:!1,saveWorkflowContext:!1,variables:{data:{}},type:null,inputProperties:{data:{}},outputProperties:{data:{}},propertyStorageProviders:{}};const r=await i(this.serverUrl);if(t&&t.length>0)try{s=await r.workflowRegistryApi.get(t,{isLatest:!0})}catch(e){console.warn("The specified workflow blueprint does not exist. Creating a new one.")}this.updateModels(s)}async serverUrlChangedHandler(e){e&&e.length>0&&await this.loadActivityDescriptors()}async componentWillLoad(){await this.serverUrlChangedHandler(this.serverUrl),await this.workflowDefinitionIdChangedHandler(this.workflowDefinitionId)}componentDidLoad(){this.designer||(this.designer=this.el.querySelector("elsa-designer-tree"),this.designer.model=this.workflowModel)}async loadActivityDescriptors(){const e=await i(this.serverUrl);n.activityDescriptors=await e.activitiesApi.list()}updateModels(e){this.workflowBlueprint=e,this.workflowModel=this.mapWorkflowModel(e)}mapWorkflowModel(e){return{activities:e.activities.filter((t=>t.parentId==e.id||!t.parentId)).map(this.mapActivityModel),connections:e.connections.map(this.mapConnectionModel),persistenceBehavior:e.persistenceBehavior}}mapActivityModel(e){const t=n.activityDescriptors.find((t=>t.type==e.type)),s=r.map(e.inputProperties.data,((e,s)=>{const r=t.inputProperties.find((e=>e.name==s)),o=(null==r?void 0:r.defaultSyntax)||a.Literal,i={};return i[o]=e,{name:s,expressions:i,syntax:o}}));return{activityId:e.id,description:e.description,displayName:e.displayName||e.name||e.type,name:e.name,type:e.type,properties:s,outcomes:[...t.outcomes],persistWorkflow:e.persistWorkflow,saveWorkflowContext:e.saveWorkflowContext,loadWorkflowContext:e.loadWorkflowContext,propertyStorageProviders:e.propertyStorageProviders}}mapConnectionModel(e){return{sourceId:e.sourceActivityId,targetId:e.targetActivityId,outcome:e.outcome}}render(){return t(s,{class:"elsa-flex elsa-flex-col elsa-w-full elsa-relative",ref:e=>this.el=e},this.renderCanvas())}renderCanvas(){return t("div",{class:"elsa-flex-1 elsa-flex"},t("elsa-designer-tree",{model:this.workflowModel,class:"elsa-flex-1",ref:e=>this.designer=e,mode:l.Blueprint}),t("elsa-flyout-panel",null,t("elsa-tab-header",{tab:"general",slot:"header"},"General"),t("elsa-tab-content",{tab:"general",slot:"content"},t("elsa-workflow-blueprint-properties-panel",{workflowId:this.workflowDefinitionId}))))}static get watchers(){return{workflowDefinitionId:["workflowDefinitionIdChangedHandler"],serverUrl:["serverUrlChangedHandler"]}}};p.injectProps(c,["serverUrl","culture"]);export{c as elsa_workflow_blueprint_viewer_screen}