import{r as t,c as e,h as s,H as i}from"./p-ee0b9025.js";import{i as a}from"./p-273970f1.js";import{c as l,a as n}from"./p-c74b54ba.js";import{E as o}from"./p-d8454b73.js";import{e as r}from"./p-93cac3a6.js";import{a as c}from"./p-4d2049bc.js";import{f as h}from"./p-34c33cf9.js";import"./p-4ebd2c24.js";import"./p-ca993e0f.js";import"./p-949334ec.js";import{a as d}from"./p-e1c2279c.js";import{T as u}from"./p-37df3757.js";import{T as f}from"./p-64c0718a.js";import{L as w,W as p}from"./p-79414d9f.js";import{l as y}from"./p-d66dbbd6.js";import{c as v}from"./p-a3b5bd35.js";import"./p-1b1f9628.js";import"./p-83f217d4.js";import"./p-3c89b68a.js";import"./p-80de33dc.js";const m={en:{default:{Publishing:"Publishing...",Published:"Published",ActivityContextMenu:{Edit:"Edit",Delete:"Delete",DeleteSelected:"Delete Selected"},ConnectionContextMenu:{Paste:"Paste"},Restart:"Restart"}},"zh-CN":{default:{Publishing:"发布中...",Published:"已发布",ActivityContextMenu:{Edit:"编辑",Delete:"删除",DeleteSelected:"删除所选"},ConnectionContextMenu:{Paste:"粘贴"},Restart:"重启"}},"nl-NL":{default:{Publishing:"Publiceren...",Published:"Gepubliceerd",ActivityContextMenu:{Edit:"Bewerken",Delete:"Verwijderen",DeleteSelected:"Verwijder Geselecteerde"},ConnectionContextMenu:{Paste:"Plakken"},Restart:"Herstarten"}}};let g=class{constructor(i){t(this,i),this.workflowSaved=e(this,"workflowSaved",7),this.serverFeatures=[],this.workflowTestActivityMessages=[],this.layoutDirection=w.TopBottom,this.activityContextMenuState={shown:!1,x:0,y:0,activity:null,selectedActivities:{}},this.activityContextMenuTestState={shown:!1,x:0,y:0,activity:null},this.configureComponentCustomButtonContext=null,this.t=t=>this.i18next.t(t),this.onTestActivityMessageReceived=async t=>{const e=t;e?(this.workflowInstanceId=e.workflowInstanceId,this.workflowTestActivityMessages=this.workflowTestActivityMessages.filter((t=>t.activityId!==e.activityId)),this.workflowTestActivityMessages=[...this.workflowTestActivityMessages,e]):(this.workflowTestActivityMessages=[],this.workflowInstanceId=null),this.render()},this.onUpdateWorkflowSettings=async t=>{this.updateWorkflowDefinition(t),await this.saveWorkflowInternal(this.workflowModel)},this.onFlyoutPanelTabSelected=async t=>{const e=t;"general"===e&&(this.workflowDesignerMode=p.Edit),"test"===e&&(this.workflowDesignerMode=p.Test),this.render()},this.onUpdateActivity=t=>{const e=this.workflowTestActivityMessages.find((e=>e.activityId===t.activityId));e&&(e.status=l.Modified,this.clearSubsequentWorkflowTestMessages(t.activityId))},this.renderActivityStatsButton=t=>{const e=this.workflowTestActivityMessages.find((e=>e.activityId==t.activityId));if(null==e)return"";let s;switch(e.status){case l.Done:s='<svg class="elsa-h-8 elsa-w-8 elsa-text-green-500"  fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                </svg>';break;case l.Waiting:s='<svg version="1.1" class="svg-loader" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 80 80" xml:space="preserve">\n                  <path id="spinner" fill="#7eb0de" d="M40,72C22.4,72,8,57.6,8,40C8,22.4,\n                  22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2\n                  s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,\n                  28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.75s" repeatCount="indefinite" />\n                  </path>\n                  </path>\n              </svg>';break;case l.Failed:s='<svg class="elsa-h-8 elsa-w-8 elsa-text-red-500"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <circle cx="12" cy="12" r="10" />\n                  <line x1="15" y1="9" x2="9" y2="15" />\n                  <line x1="9" y1="9" x2="15" y2="15" />\n                </svg>';break;case l.Modified:s='<svg class="h-6 w-6 elsa-text-yellow-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <line x1="12" y1="16" x2="12" y2="12"></line>\n                    <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                </svg>'}return`<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              ${s}\n            </button>\n          </div>`},this.renderTestActivityMenu=()=>{const t=this.workflowTestActivityMessages.find((t=>t.activityId==this.selectedActivityId)),e=()=>{var e,i;if(null!=t&&t&&t.error)return s("div",{class:"elsa-ml-4"},s("elsa-workflow-fault-information",{workflowFault:null===(e=this.workflowInstance)||void 0===e?void 0:e.fault,faultedAt:null===(i=this.workflowInstance)||void 0===i?void 0:i.faultedAt}))},i=()=>{if(!t.error)return s("div",{class:"elsa-ml-4"},s("elsa-workflow-performance-information",{activityStats:this.activityStats}))},a=()=>{if(this.canBeRestartedFromCurrentActivity())return s("button",{type:"button",onClick:()=>this.onRestartActivityButtonClick(),class:"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-red-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-red-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},this.t("Restart"))},l=()=>{if(null!=this.configureComponentCustomButtonContext.data)return s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("button",{type:"button",onClick:()=>this.onComponentCustomButtonClick(t),class:"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},this.configureComponentCustomButtonContext.data.label))};return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuTestState.shown?"":"hidden")+" elsa-absolute elsa-z-10 elsa-mt-3 elsa-px-2 elsa-w-screen elsa-max-w-xl sm:elsa-px-0",style:{left:`${this.activityContextMenuTestState.x+64}px`,top:this.activityContextMenuTestState.y-256+"px"},ref:t=>this.componentCustomButton=t},s("div",{class:"elsa-rounded-lg elsa-shadow-lg elsa-ring-1 elsa-ring-black elsa-ring-opacity-5 elsa-overflow-hidden"},t?(()=>{var n,o;const r=this.t;if(null==t||!t)return;this.configureComponentCustomButton(t);const c={},h={State:!0,Input:null,Outcomes:!0,Exception:!0};for(const e in t.data){if(!t.data.hasOwnProperty(e))continue;if(h[e])continue;const s=t.data[e];if(!s&&0!=s)continue;let i=null;i="string"==typeof s?s:"object"==typeof s?JSON.stringify(s,null,1):void 0===s?null:s.toString(),c[e]=i}const d=!!(null===(o=null===(n=t.data)||void 0===n?void 0:n.Input)||void 0===o?void 0:o.Body);return s("div",{class:"elsa-relative elsa-grid elsa-gap-6 elsa-bg-white px-5 elsa-py-6 sm:elsa-gap-8 sm:elsa-p-8"},s("div",{class:"elsa-flex elsa-flex-row elsa-justify-between"},s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},r("Status")),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},t.status)),s("div",null,a())),v.map(c,((t,e)=>s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},e),s("pre",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500 elsa-overflow-x-auto"},t)))),d?l():void 0,e(),i())})():s("div",{class:"elsa-p-6 elsa-bg-white"},"Loading...")))},this.showHelpModal=async()=>{await this.helpDialog.show()},this.renderDesignerPanel=()=>{if(0!=h.getUIFeatureList().length)return[s("elsa-tab-header",{tab:"designer",slot:"header"},"Designer"),s("elsa-tab-content",{tab:"designer",slot:"content"},s("elsa-designer-panel",{onFeatureChanged:this.handleFeatureChange,onFeatureStatusChanged:this.handleFeatureStatusChange}))]},this.renderVersionHistoryPanel=t=>[s("elsa-tab-header",{tab:"versionHistory",slot:"header"},"Version History"),s("elsa-tab-content",{tab:"versionHistory",slot:"content"},s("elsa-version-history-panel",{workflowDefinition:t,onVersionSelected:t=>this.onVersionSelected(t),onDeleteVersionClicked:t=>this.onDeleteVersionClicked(t),onRevertVersionClicked:t=>this.onRevertVersionClicked(t)}))],this.handleFeatureChange=t=>{const e=t.detail;if(e===h.supportedFeatures.workflowLayout){const t=h.getFeatureConfig(e);this.layoutDirection=t.value}},this.handleFeatureStatusChange=t=>{const e=t.detail;if(e===h.supportedFeatures.workflowLayout){const t=h.getFeatureConfig(e);this.layoutDirection=t.enabled?t.value:w.TopBottom}},this.onVersionSelected=async t=>{const e=await c(this.serverUrl),s=t.detail,i=await e.workflowDefinitionsApi.getByDefinitionAndVersion(s.definitionId,{version:s.version});this.updateWorkflowDefinition(i)},this.onDeleteVersionClicked=async t=>{const e=await c(this.serverUrl),s=t.detail;await e.workflowDefinitionsApi.delete(s.definitionId,{version:s.version}),this.updateWorkflowDefinition(Object.assign({},this.workflowDefinition))},this.onRevertVersionClicked=async t=>{const e=await c(this.serverUrl),s=t.detail,i=await e.workflowDefinitionsApi.revert(s.definitionId,s.version);this.updateWorkflowDefinition(i)}}async getServerUrl(){return this.serverUrl}async getWorkflowDefinitionId(){return this.workflowDefinition.definitionId}async exportWorkflow(){const t=await c(this.serverUrl),e=this.workflowDefinition,s={version:e.version},i=await t.workflowDefinitionsApi.export(e.definitionId,s);var a;a={contentType:"application/json",fileName:i.fileName},function(t,e){const s=document.createElement("a");s.href=t,s.download=null!=e.fileName?e.fileName:"",s.click(),s.remove()}(window.URL.createObjectURL(i.data),a)}async importWorkflow(t){const e=await c(this.serverUrl);this.importing=!0,this.imported=!1,this.networkError=null;try{const s=await e.workflowDefinitionsApi.import(this.workflowDefinition.definitionId,t);this.workflowDefinition=s,this.workflowModel=this.mapWorkflowModel(s),this.updateUrl(s.definitionId),this.importing=!1,this.imported=!0,setTimeout((()=>this.imported=!1),500),await r.emit(o.WorkflowImported,this,this.workflowDefinition)}catch(t){console.error(t),this.importing=!1,this.imported=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),1e4)}}async workflowDefinitionIdChangedHandler(t){const e=t;let s=g.createWorkflowDefinition();s.definitionId=e;const i=await c(this.serverUrl);if(e&&e.length>0)try{s=await i.workflowDefinitionsApi.getByDefinitionAndVersion(e,{isLatest:!0})}catch(t){console.warn("The specified workflow definition does not exist. Creating a new one.")}this.updateWorkflowDefinition(s)}async serverUrlChangedHandler(t){t&&t.length>0&&(await this.loadActivityDescriptors(),await this.loadWorkflowStorageDescriptors())}async monacoLibPathChangedHandler(t){d.monacoLibPath=t}async workflowChangedHandler(t){const e=t.detail;await this.saveWorkflowInternal(e)}onWindowClicked(t){const e=t.target;this.componentCustomButton.contains(e)||this.handleContextMenuTestChange(0,0,!1,null),this.activityContextMenu.contains(e)||this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null,selectedActivities:{}})}async componentWillLoad(){this.i18next=await y(this.culture,m),this.workflowDesignerMode=p.Edit;const t=h.getFeatureConfig(h.supportedFeatures.workflowLayout);t&&t.enabled&&(this.layoutDirection=t.value),await this.serverUrlChangedHandler(this.serverUrl),await this.workflowDefinitionIdChangedHandler(this.workflowDefinitionId),await this.monacoLibPathChangedHandler(this.monacoLibPath)}async componentDidLoad(){this.designer||(this.designer=this.el.querySelector("elsa-designer-tree"),this.designer.model=this.workflowModel)}connectedCallback(){r.on(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings),r.on(o.FlyoutPanelTabSelected,this.onFlyoutPanelTabSelected),r.on(o.TestActivityMessageReceived,this.onTestActivityMessageReceived),r.on(o.UpdateActivity,this.onUpdateActivity)}disconnectedCallback(){r.detach(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings),r.detach(o.FlyoutPanelTabSelected,this.onFlyoutPanelTabSelected),r.detach(o.TestActivityMessageReceived,this.onTestActivityMessageReceived),r.detach(o.UpdateActivity,this.onUpdateActivity)}async configureComponentCustomButton(t){this.configureComponentCustomButtonContext={component:"elsa-workflow-definition-editor-screen",activityType:t.activityType,prop:null,data:null},await r.emit(o.ComponentLoadingCustomButton,this,this.configureComponentCustomButtonContext)}async loadActivityDescriptors(){const t=await c(this.serverUrl);d.activityDescriptors=await t.activitiesApi.list()}async loadWorkflowStorageDescriptors(){const t=await c(this.serverUrl);d.workflowStorageDescriptors=await t.workflowStorageProvidersApi.list()}async tryUpdateActivityInformation(t){if(!this.workflowInstanceId)return this.activityStats=null,void(this.workflowInstance=null);const e=await c(this.serverUrl);this.activityStats=await e.activityStatsApi.get(this.workflowInstanceId,t),this.workflowInstance&&this.workflowInstance.id===this.workflowInstanceId||(this.workflowInstance=await e.workflowInstancesApi.get(this.workflowInstanceId))}updateWorkflowDefinition(t){this.workflowDefinition=t,this.workflowModel=this.mapWorkflowModel(t)}async publishWorkflow(){this.publishing=!0,await this.saveWorkflow(!0),this.publishing=!1,await r.emit(o.WorkflowPublished,this,this.workflowDefinition)}async unpublishWorkflow(){await this.unpublishWorkflowInternal(),await r.emit(o.WorkflowRetracted,this,this.workflowDefinition)}async revertWorkflow(){await this.revertWorkflowInternal()}async saveWorkflow(t){await this.saveWorkflowInternal(null,t)}async saveWorkflowInternal(t,e){if(!this.serverUrl||0==this.serverUrl.length)return;t=t||this.workflowModel;const s=await c(this.serverUrl);let i=this.workflowDefinition;const a=void 0===i.definitionId&&void 0===this.workflowDefinitionId,l={workflowDefinitionId:i.definitionId||this.workflowDefinitionId,contextOptions:i.contextOptions,deleteCompletedInstances:i.deleteCompletedInstances,description:i.description,displayName:i.displayName,isSingleton:i.isSingleton,name:i.name,tag:i.tag,channel:i.channel,persistenceBehavior:i.persistenceBehavior,publish:e||!1,variables:i.variables,activities:t.activities.map((t=>({activityId:t.activityId,type:t.type,name:t.name,displayName:t.displayName,description:t.description,persistWorkflow:t.persistWorkflow,loadWorkflowContext:t.loadWorkflowContext,saveWorkflowContext:t.saveWorkflowContext,properties:t.properties,propertyStorageProviders:t.propertyStorageProviders}))),connections:t.connections.map((t=>({sourceActivityId:t.sourceId,targetActivityId:t.targetId,outcome:t.outcome})))};this.saving=!e,this.publishing=e;try{console.debug("Saving workflow..."),i=await s.workflowDefinitionsApi.save(l),this.workflowDefinition=i,this.workflowModel=this.mapWorkflowModel(i),this.saving=!1,this.saved=!e,this.publishing=!1,setTimeout((()=>this.saved=!1),500),this.workflowSaved.emit(i),a&&this.updateUrl(i.definitionId)}catch(t){console.error(t),this.saving=!1,this.saved=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),1e4)}}async unpublishWorkflowInternal(){const t=await c(this.serverUrl),e=this.workflowDefinition.definitionId;this.unPublishing=!0;try{this.workflowDefinition=await t.workflowDefinitionsApi.retract(e),this.unPublishing=!1,this.unPublished=!0,setTimeout((()=>this.unPublished=!1),500)}catch(t){console.error(t),this.unPublishing=!1,this.unPublished=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),2e3)}}async revertWorkflowInternal(){const t=await c(this.serverUrl),e=this.workflowDefinition.definitionId,s=this.workflowDefinition.version;this.reverting=!0;try{this.workflowDefinition=await t.workflowDefinitionsApi.revert(e,s),this.reverting=!1,this.reverted=!0,setTimeout((()=>this.reverted=!1),500)}catch(t){console.error(t),this.reverting=!1,this.reverted=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),2e3)}}updateUrl(t){this.history&&this.history.push(`${this.basePath}/workflow-definitions/${t}`,{})}mapWorkflowModel(t){return{activities:t.activities.map(this.mapActivityModel),connections:t.connections.map(this.mapConnectionModel),persistenceBehavior:t.persistenceBehavior}}mapActivityModel(t){const e=d.activityDescriptors.find((e=>e.type==t.type));return{activityId:t.activityId,description:t.description,displayName:t.displayName,name:t.name,type:t.type,properties:t.properties,outcomes:[...e?e.outcomes:["Done"]],persistWorkflow:t.persistWorkflow,saveWorkflowContext:t.saveWorkflowContext,loadWorkflowContext:t.loadWorkflowContext,propertyStorageProviders:t.propertyStorageProviders}}mapConnectionModel(t){return{sourceId:t.sourceActivityId,targetId:t.targetActivityId,outcome:t.outcome}}handleContextMenuChange(t){this.activityContextMenuState=t}handleContextMenuTestChange(t,e,s,i){this.activityContextMenuTestState={shown:s,x:t,y:e,activity:i}}async onShowWorkflowSettingsClick(){await r.emit(o.ShowWorkflowSettings)}async onPublishClicked(){await this.publishWorkflow()}async onUnPublishClicked(){await this.unpublishWorkflow()}async onRevertClicked(){await this.revertWorkflow()}async onExportClicked(){await this.exportWorkflow()}async onImportClicked(t){await this.importWorkflow(t)}async onDeleteActivityClick(t){t.preventDefault();const{activity:e,selectedActivities:s}=this.activityContextMenuState;s[e.activityId]?await this.designer.removeSelectedActivities():await this.designer.removeActivity(e),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null,selectedActivities:{}}),await r.emit(o.HideModalDialog)}async onEditActivityClick(t){t.preventDefault(),await this.designer.showActivityEditor(this.activityContextMenuState.activity,!0),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null})}async onActivityContextMenuButtonClicked(t){this.activityContextMenuState=t.detail}async onActivityContextMenuButtonTestClicked(t){this.activityContextMenuTestState=t.detail,this.selectedActivityId=t.detail.activity.activityId,t.detail.shown&&await this.tryUpdateActivityInformation(this.selectedActivityId)}async onActivitySelected(t){this.selectedActivityId=t.detail.activityId}async onActivityDeselected(t){this.selectedActivityId==t.detail.activityId&&(this.selectedActivityId=null)}async onRestartActivityButtonClick(){await r.emit(o.WorkflowRestarted,this,this.selectedActivityId),this.handleContextMenuTestChange(0,0,!1,null)}clearSubsequentWorkflowTestMessages(t){var e;const s=null===(e=this.workflowDefinition.connections.find((e=>e.sourceActivityId===t)))||void 0===e?void 0:e.targetActivityId;s&&(this.workflowTestActivityMessages=this.workflowTestActivityMessages.filter((t=>t.activityId!==s||t.status===l.Failed)),this.clearSubsequentWorkflowTestMessages(s))}render(){return s(i,{class:"elsa-flex elsa-flex-col elsa-w-full",ref:t=>this.el=t},s(u.Provider,{state:{serverUrl:this.serverUrl,workflowDefinitionId:this.workflowDefinition.definitionId,serverFeatures:this.serverFeatures}},this.renderCanvas(),this.renderActivityPicker(),this.renderActivityEditor()))}renderCanvas(){return s("div",{class:"elsa-flex-1 elsa-flex elsa-relative"},s("elsa-designer-tree",{model:this.workflowModel,mode:this.workflowDesignerMode,layoutDirection:this.layoutDirection,activityContextMenuButton:this.workflowDesignerMode==p.Edit?()=>'<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              <svg class="elsa-h-6 elsa-w-6 elsa-text-gray-400" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"\n                   stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n                <path stroke="none" d="M0 0h24v24H0z"/>\n                <circle cx="5" cy="12" r="1"/>\n                <circle cx="12" cy="12" r="1"/>\n                <circle cx="19" cy="12" r="1"/>\n              </svg>\n            </button>\n          </div>':this.renderActivityStatsButton,onActivityContextMenuButtonClicked:t=>this.onActivityContextMenuButtonClicked(t),onActivityContextMenuButtonTestClicked:t=>this.onActivityContextMenuButtonTestClicked(t),activityContextMenu:this.workflowDesignerMode==p.Edit?this.activityContextMenuState:this.activityContextMenuTestState,enableMultipleConnectionsFromSingleSource:!1,selectedActivityIds:[this.selectedActivityId],onActivitySelected:t=>this.onActivitySelected(t),onActivityDeselected:t=>this.onActivityDeselected(t),class:"elsa-flex-1",ref:t=>this.designer=t}),this.renderWorkflowSettingsButton(),this.renderWorkflowHelpButton(),this.renderPanel(),this.renderActivityContextMenu(),s("elsa-workflow-settings-modal",{workflowDefinition:this.workflowDefinition}),s("elsa-workflow-definition-editor-notifications",null),s("div",{class:"elsa-fixed elsa-bottom-10 elsa-right-12"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-4"},this.renderSavingIndicator(),this.renderNetworkError(),this.renderPublishButton())),this.renderTestActivityMenu())}async onComponentCustomButtonClick(t){const e=Object.assign({},this.workflowModel).activities.find((e=>e.activityId==t.activityId)),s={component:"elsa-workflow-definition-editor-screen",activityType:t.activityType,prop:null,params:[e,t.data.Input]};await r.emit(o.ComponentCustomButtonClick,this,s)}canBeRestartedFromCurrentActivity(){var t;if(!this.selectedActivityId)return!1;if(this.workflowDesignerMode!==p.Test)return!1;if(this.workflowTestActivityMessages.some((t=>t.activityId===this.selectedActivityId)))return!0;const e=null===(t=this.workflowDefinition.connections.find((t=>t.targetActivityId===this.selectedActivityId)))||void 0===t?void 0:t.sourceActivityId;return e&&this.workflowTestActivityMessages.some((t=>t.activityId===e&&t.status!==l.Failed))}renderActivityContextMenu(){var t;const e=this.t,i=Object.keys(null!==(t=this.activityContextMenuState.selectedActivities)&&void 0!==t?t:{}),{activity:a}=this.activityContextMenuState;return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuState.shown?"":"hidden")+" context-menu elsa-z-10 elsa-mx-3 elsa-w-48 elsa-mt-1 elsa-rounded-md elsa-shadow-lg elsa-fixed",style:{left:`${this.activityContextMenuState.x}px`,top:`${this.activityContextMenuState.y}px`},ref:t=>this.activityContextMenu=t},s("div",{class:"elsa-rounded-md elsa-bg-white elsa-shadow-xs",role:"menu","aria-orientation":"vertical","aria-labelledby":"pinned-project-options-menu-0"},s("div",{class:"elsa-py-1"},s("a",{onClick:t=>this.onEditActivityClick(t),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},e("ActivityContextMenu.Edit"))),s("div",{class:"elsa-border-t elsa-border-gray-100"}),s("div",{class:"elsa-py-1"},s("a",{onClick:t=>this.onDeleteActivityClick(t),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},i.length>1&&-1!==i.indexOf(a.activityId)?e("ActivityContextMenu.DeleteSelected"):e("ActivityContextMenu.Delete")))))}renderActivityPicker(){return s("elsa-activity-picker-modal",null)}renderActivityEditor(){return s("elsa-activity-editor-modal",{culture:this.culture})}renderWorkflowSettingsButton(){return s("button",{onClick:()=>this.onShowWorkflowSettingsClick(),type:"button",class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-12 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",class:"elsa-h-8 elsa-w-8"},s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})))}renderWorkflowHelpButton(){return s("span",null,s("button",{type:"button",onClick:this.showHelpModal,class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-28 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"elsa-h-8 elsa-w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}))),s("elsa-modal-dialog",{ref:t=>this.helpDialog=t},s("div",{slot:"content",class:"elsa-p-8"},s("h3",{class:"elsa-text-lg elsa-font-medium"},"Actions"),s("dl",{class:"elsa-mt-2 elsa-border-t elsa-border-b elsa-border-gray-200 elsa-divide-y elsa-divide-gray-200"},s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Delete connections"),s("dd",{class:"elsa-text-gray-900"},"RIGHT-click the connection to delete.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Connect outcomes to existing activity"),s("dd",{class:"elsa-text-gray-900"},"Press and hold SHIFT while LEFT-clicking the outcome to connect. Release SHIFT and LEFT-click the target activity.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Pan"),s("dd",{class:"elsa-text-gray-900"},"Click anywhere on the designer and drag mouse.")),s("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},s("dt",{class:"elsa-text-gray-500"},"Zoom"),s("dd",{class:"elsa-text-gray-900"},"Use scroll-wheel on mouse."))))))}renderSavingIndicator(){if(this.publishing)return;const t=this.t,e=this.unPublishing?t("Unpublishing..."):this.unPublished?t("Unpublished"):this.saving?"Saving...":this.saved?"Saved":this.importing?"Importing...":this.imported?"Imported":null;return e?s("div",null,s("span",{class:"elsa-text-gray-400 elsa-text-sm"},e)):void 0}renderNetworkError(){if(this.networkError)return s("div",null,s("span",{class:"elsa-text-rose-400 elsa-text-sm"},"An error occurred: ",this.networkError))}renderPublishButton(){return s("elsa-workflow-publish-button",{publishing:this.publishing,workflowDefinition:this.workflowDefinition,onPublishClicked:()=>this.onPublishClicked(),onUnPublishClicked:()=>this.onUnPublishClicked(),onRevertClicked:()=>this.onRevertClicked(),onExportClicked:()=>this.onExportClicked(),onImportClicked:t=>this.onImportClicked(t.detail),culture:this.culture})}static createWorkflowDefinition(){return{definitionId:null,version:1,isLatest:!0,isPublished:!1,activities:[],connections:[],persistenceBehavior:n.WorkflowBurst}}renderPanel(){const t=this.workflowDefinition;return s("elsa-flyout-panel",{expandButtonPosition:3},s("elsa-tab-header",{tab:"general",slot:"header"},"General"),s("elsa-tab-content",{tab:"general",slot:"content"},s("elsa-workflow-properties-panel",{workflowDefinition:t})),this.renderTestPanel(),this.renderDesignerPanel(),this.renderVersionHistoryPanel(t))}renderTestPanel(){if(this.serverFeatures.find((t=>"WorkflowTesting"==t)))return[s("elsa-tab-header",{tab:"test",slot:"header"},"Test"),s("elsa-tab-content",{tab:"test",slot:"content"},s("elsa-workflow-test-panel",{workflowDefinition:this.workflowDefinition,workflowTestActivityId:this.selectedActivityId}))]}static get watchers(){return{workflowDefinitionId:["workflowDefinitionIdChangedHandler"],serverUrl:["serverUrlChangedHandler"],monacoLibPath:["monacoLibPathChangedHandler"]}}};a(g),f.injectProps(g,["serverUrl","culture","monacoLibPath","basePath","serverFeatures"]),g.style=".svg-loader{height:2rem;vertical-align:top}";export{g as elsa_workflow_definition_editor_screen}